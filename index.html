<!doctype html>
<html lang="sv">
<head>
   <meta charset="utf-8" />
   <meta name="viewport" content="width=device-width, initial-scale=1" />
   <title>Danas Naglar – Boka tid</title>
   <style>
      :root{
         --bg: #0f1220;
         --card: #171a2e;
         --muted: #a9b0d0;
         --text: #eef0ff;
         --accent: #ff6fb1;
         --accent2: #7c7bff;
         --line: rgba(255,255,255,0.10);
         --ok: #2dd4bf;
         --bad: #fb7185;
      }
      *{ box-sizing: border-box; }
      body{
         margin: 0;
         font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
         background: radial-gradient(1000px 600px at 10% 10%, rgba(124,123,255,0.25), transparent 60%),
                     radial-gradient(900px 500px at 90% 30%, rgba(255,111,177,0.25), transparent 60%),
                     var(--bg);
         color: var(--text);
      }
      header{
         padding: 28px 16px 10px;
         max-width: 980px;
         margin: 0 auto;
      }
      .brand{
         display: flex;
         gap: 12px;
         align-items: center;
      }
      .logo{
         width: 44px;
         height: 44px;
         border-radius: 12px;
         background: linear-gradient(135deg, var(--accent), var(--accent2));
         display: grid;
         place-items: center;
         font-weight: 700;
      }
      h1{
         margin: 0;
         font-size: 22px;
         letter-spacing: 0.2px;
      }
      .sub{
         margin: 6px 0 0;
         color: var(--muted);
         line-height: 1.4;
      }
      main{
         max-width: 980px;
         margin: 0 auto;
         padding: 16px;
         display: grid;
         grid-template-columns: 1.2fr 0.8fr;
         gap: 16px;
      }
      @media (max-width: 900px){
         main{ grid-template-columns: 1fr; }
      }
      .card{
         background: rgba(23,26,46,0.85);
         border: 1px solid var(--line);
         border-radius: 16px;
         padding: 16px;
         box-shadow: 0 20px 50px rgba(0,0,0,0.35);
         backdrop-filter: blur(8px);
      }
      .card h2{
         margin: 0 0 10px;
         font-size: 16px;
      }
      label{
         display: block;
         font-size: 13px;
         color: var(--muted);
         margin: 10px 0 6px;
      }
      input, select, textarea{
         width: 100%;
         border: 1px solid var(--line);
         background: rgba(255,255,255,0.04);
         color: var(--text);
         border-radius: 12px;
         padding: 10px 12px;
         outline: none;
      }
      input:focus, select:focus, textarea:focus{
         border-color: rgba(255,111,177,0.55);
         box-shadow: 0 0 0 4px rgba(255,111,177,0.12);
      }
      .row{
         display: grid;
         grid-template-columns: 1fr 1fr;
         gap: 12px;
      }
      @media (max-width: 520px){
         .row{ grid-template-columns: 1fr; }
      }
      .slots{
         display: flex;
         flex-wrap: wrap;
         gap: 8px;
         margin-top: 10px;
      }
      .slot-btn{
         border: 1px solid var(--line);
         background: rgba(255,255,255,0.04);
         color: var(--text);
         padding: 8px 10px;
         border-radius: 999px;
         cursor: pointer;
         font-size: 13px;
      }
      .slot-btn:hover{ border-color: rgba(124,123,255,0.5); }
      .slot-btn[disabled]{
         opacity: 0.35;
         cursor: not-allowed;
      }
      .slot-btn.selected{
         border-color: rgba(255,111,177,0.75);
         background: rgba(255,111,177,0.18);
      }
      .actions{
         display: flex;
         gap: 10px;
         margin-top: 14px;
         flex-wrap: wrap;
      }
      button.primary{
         border: none;
         background: linear-gradient(135deg, var(--accent), var(--accent2));
         color: #0b0d16;
         font-weight: 700;
         padding: 10px 14px;
         border-radius: 12px;
         cursor: pointer;
      }
      button.secondary{
         border: 1px solid var(--line);
         background: rgba(255,255,255,0.04);
         color: var(--text);
         padding: 10px 14px;
         border-radius: 12px;
         cursor: pointer;
      }
      button.secondary:hover{ border-color: rgba(255,255,255,0.25); }
      .hint{
         color: var(--muted);
         font-size: 13px;
         line-height: 1.4;
         margin-top: 8px;
      }
      .pill{
         display: inline-flex;
         gap: 8px;
         align-items: center;
         border: 1px solid var(--line);
         padding: 10px 12px;
         border-radius: 14px;
         background: rgba(255,255,255,0.03);
      }
      .pill strong{ font-size: 13px; }
      .divider{
         height: 1px;
         background: var(--line);
         margin: 12px 0;
      }
      .toast{
         display: none;
         margin-top: 12px;
         border-radius: 14px;
         border: 1px solid var(--line);
         padding: 12px;
      }
      .toast.ok{ display: block; border-color: rgba(45,212,191,0.35); background: rgba(45,212,191,0.08); }
      .toast.bad{ display: block; border-color: rgba(251,113,133,0.35); background: rgba(251,113,133,0.08); }
      .admin-table{
         width: 100%;
         border-collapse: collapse;
         margin-top: 10px;
         font-size: 13px;
      }
      .admin-table th, .admin-table td{
         border-bottom: 1px solid var(--line);
         padding: 10px 8px;
         text-align: left;
         vertical-align: top;
      }
      .admin-table th{ color: var(--muted); font-weight: 600; }
      .tag{
         display: inline-block;
         padding: 4px 8px;
         border-radius: 999px;
         border: 1px solid var(--line);
         font-size: 12px;
         color: var(--muted);
      }
      a{ color: var(--text); }
   </style>
</head>

<body>
<header>
   <div class="brand">
      <div class="logo">DN</div>
      <div>
         <h1>Danas Naglar</h1>
         <p class="sub">Boka din tid direkt. Ingen betalning online – du betalar på plats.</p>
      </div>
   </div>
</header>

<main>
   <section class="card" id="bookingCard">
      <h2>Boka tid</h2>

      <div class="row">
         <div>
            <label for="service">Behandling</label>
            <select id="service">
               <option value="Nytt set (Gel)">Nytt set (Gel) – 90 min</option>
               <option value="Påfyllning (Gel)">Påfyllning (Gel) – 60 min</option>
               <option value="Manikyr">Manikyr – 45 min</option>
               <option value="Borttagning">Borttagning – 30 min</option>
            </select>
         </div>
         <div>
            <label for="date">Datum</label>
            <input type="date" id="date" />
         </div>
      </div>

      <label>Tid (välj en ledig tid)</label>
      <div class="slots" id="slots"></div>

      <div class="divider"></div>

      <div class="row">
         <div>
            <label for="name">Namn</label>
            <input id="name" placeholder="För- och efternamn" autocomplete="name" />
         </div>
         <div>
            <label for="phone">Telefon</label>
            <input id="phone" placeholder="07X XXX XX XX" inputmode="tel" autocomplete="tel" />
         </div>
      </div>

      <div class="row">
         <div>
            <label for="email">E-post (valfritt)</label>
            <input id="email" placeholder="namn@mail.com" inputmode="email" autocomplete="email" />
         </div>
         <div>
            <label for="notes">Meddelande (valfritt)</label>
            <input id="notes" placeholder="Ex: korta naglar, fransk, färg..." />
         </div>
      </div>

      <div class="actions">
         <button class="primary" id="bookBtn">Boka tid</button>
         <button class="secondary" id="icsBtn" title="Skapa kalenderhändelse">Lägg i kalender</button>
         <button class="secondary" id="clearBtn" title="Rensa formulär">Rensa</button>
      </div>

      <div class="toast" id="toast"></div>
      <p class="hint">
         Tips: För admin-lista, öppna sidan med <span class="tag">?admin=1</span>.
         Bokningar sparas lokalt i webbläsaren (för en riktig salong: koppla till e-post/databas).
      </p>
   </section>

   <aside class="card" id="infoCard">
      <h2>Info</h2>
      <div class="pill"><strong>Adress:</strong> <span id="address">Valfri adress här</span></div>
      <div class="pill" style="margin-top:10px;"><strong>Öppettider:</strong> <span>Mån–Fre 10:00–18:00</span></div>
      <div class="pill" style="margin-top:10px;"><strong>Avbokning:</strong> <span>Senast 24 timmar innan</span></div>

      <div class="divider"></div>

      <h2 id="adminTitle" style="display:none;">Admin – Bokningar</h2>
      <div id="adminArea" style="display:none;">
         <div class="actions">
            <button class="secondary" id="exportBtn">Exportera JSON</button>
            <button class="secondary" id="wipeBtn">Radera alla</button>
         </div>
         <table class="admin-table" id="adminTable">
            <thead>
               <tr>
                  <th>Datum & tid</th>
                  <th>Behandling</th>
                  <th>Namn</th>
                  <th>Telefon</th>
                  <th>Notis</th>
               </tr>
            </thead>
            <tbody></tbody>
         </table>
         <p class="hint">Admin-listan visar bara bokningar som finns sparade i denna enhet/webbläsare.</p>
      </div>
   </aside>
</main>

<script>
   const STORAGE_KEY = "danas_naglar_bookings_v1";

   const serviceEl = document.getElementById("service");
   const dateEl = document.getElementById("date");
   const slotsEl = document.getElementById("slots");
   const nameEl = document.getElementById("name");
   const phoneEl = document.getElementById("phone");
   const emailEl = document.getElementById("email");
   const notesEl = document.getElementById("notes");
   const toastEl = document.getElementById("toast");

   const bookBtn = document.getElementById("bookBtn");
   const clearBtn = document.getElementById("clearBtn");
   const icsBtn = document.getElementById("icsBtn");

   const adminTitle = document.getElementById("adminTitle");
   const adminArea = document.getElementById("adminArea");
   const adminTableBody = document.querySelector("#adminTable tbody");
   const exportBtn = document.getElementById("exportBtn");
   const wipeBtn = document.getElementById("wipeBtn");

   let selectedTime = null;

   function todayISO(){
      const d = new Date();
      const pad = (n) => String(n).padStart(2, "0");
      return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`;
   }

   function getBookings(){
      try{
         return JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");
      }catch(e){
         return [];
      }
   }

   function saveBookings(list){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(list));
   }

   function bookingKey(dateISO, timeStr){
      return `${dateISO}__${timeStr}`;
   }

   function showToast(type, html){
      toastEl.className = `toast ${type}`;
      toastEl.innerHTML = html;
   }

   function clearToast(){
      toastEl.className = "toast";
      toastEl.innerHTML = "";
   }

   function timesForDay(){
      // Exempel: 10:00–17:00, var 30:e minut
      const start = 10 * 60;
      const end = 17 * 60;
      const step = 30;
      const out = [];
      for(let m = start; m <= end; m += step){
         const hh = String(Math.floor(m / 60)).padStart(2, "0");
         const mm = String(m % 60).padStart(2, "0");
         out.push(`${hh}:${mm}`);
      }
      return out;
   }

   function renderSlots(){
      slotsEl.innerHTML = "";
      selectedTime = null;

      const dateISO = dateEl.value;
      if(!dateISO){
         slotsEl.innerHTML = `<span class="tag">Välj datum först</span>`;
         return;
      }

      const bookings = getBookings();
      const bookedSet = new Set(bookings.map(b => bookingKey(b.date, b.time)));

      for(const t of timesForDay()){
         const btn = document.createElement("button");
         btn.type = "button";
         btn.className = "slot-btn";
         btn.textContent = t;

         const isBooked = bookedSet.has(bookingKey(dateISO, t));
         if(isBooked){
            btn.disabled = true;
            btn.title = "Upptagen";
         }

         btn.addEventListener("click", () => {
            document.querySelectorAll(".slot-btn").forEach(b => b.classList.remove("selected"));
            btn.classList.add("selected");
            selectedTime = t;
            clearToast();
         });

         slotsEl.appendChild(btn);
      }
   }

   function validate(){
      const dateISO = dateEl.value;
      if(!dateISO) return "Välj datum.";
      if(!selectedTime) return "Välj en tid.";
      if(!nameEl.value.trim()) return "Skriv ditt namn.";
      if(!phoneEl.value.trim()) return "Skriv ditt telefonnummer.";
      return null;
   }

   function createBookingObject(){
      return {
         id: crypto.randomUUID ? crypto.randomUUID() : String(Date.now()),
         createdAt: new Date().toISOString(),
         service: serviceEl.value,
         date: dateEl.value,
         time: selectedTime,
         name: nameEl.value.trim(),
         phone: phoneEl.value.trim(),
         email: emailEl.value.trim(),
         notes: notesEl.value.trim()
      };
   }

   function book(){
      clearToast();
      const err = validate();
      if(err){
         showToast("bad", `<strong>Fel:</strong> ${err}`);
         return;
      }

      const booking = createBookingObject();
      const bookings = getBookings();

      const key = bookingKey(booking.date, booking.time);
      const exists = bookings.some(b => bookingKey(b.date, b.time) === key);
      if(exists){
         showToast("bad", `<strong>Tiden är redan bokad.</strong> Välj en annan tid.`);
         renderSlots();
         return;
      }

      bookings.push(booking);
      bookings.sort((a,b) => (a.date+a.time).localeCompare(b.date+b.time));
      saveBookings(bookings);

      showToast("ok", `
         <strong>Bokningen är sparad!</strong><br/>
         ${booking.service}<br/>
         ${booking.date} kl ${booking.time}<br/>
         Namn: ${escapeHtml(booking.name)}<br/>
         Telefon: ${escapeHtml(booking.phone)}
      `);

      renderSlots();
      renderAdmin();
   }

   function clearForm(){
      nameEl.value = "";
      phoneEl.value = "";
      emailEl.value = "";
      notesEl.value = "";
      selectedTime = null;
      clearToast();
      renderSlots();
   }

   function escapeHtml(s){
      return s.replace(/[&<>"']/g, (c) => ({
         "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
      }[c]));
   }

   // --- ICS (kalender) ---
   function pad2(n){ return String(n).padStart(2, "0"); }

   function toICSDateTimeLocal(dateISO, timeStr){
      // Skapar "lokal" tid i ICS (utan Z). Fungerar bra för enkel användning.
      const [y,m,d] = dateISO.split("-").map(Number);
      const [hh,mm] = timeStr.split(":").map(Number);
      return `${y}${pad2(m)}${pad2(d)}T${pad2(hh)}${pad2(mm)}00`;
   }

   function minutesForService(service){
      if(service.includes("90")) return 90;
      if(service.includes("60")) return 60;
      if(service.includes("45")) return 45;
      if(service.includes("30")) return 30;
      // fallback
      if(service.includes("Nytt set")) return 90;
      if(service.includes("Påfyllning")) return 60;
      if(service.includes("Manikyr")) return 45;
      if(service.includes("Borttagning")) return 30;
      return 60;
   }

   function addMinutes(dateISO, timeStr, minutes){
      const [y,m,d] = dateISO.split("-").map(Number);
      const [hh,mm] = timeStr.split(":").map(Number);
      const dt = new Date(y, m-1, d, hh, mm, 0);
      dt.setMinutes(dt.getMinutes() + minutes);
      return {
         date: `${dt.getFullYear()}-${pad2(dt.getMonth()+1)}-${pad2(dt.getDate())}`,
         time: `${pad2(dt.getHours())}:${pad2(dt.getMinutes())}`
      };
   }

   function downloadICS(){
      clearToast();
      const err = validate();
      if(err){
         showToast("bad", `<strong>Fel:</strong> ${err}`);
         return;
      }

      const service = serviceEl.value;
      const dateISO = dateEl.value;
      const start = toICSDateTimeLocal(dateISO, selectedTime);
      const dur = minutesForService(service);
      const endObj = addMinutes(dateISO, selectedTime, dur);
      const end = toICSDateTimeLocal(endObj.date, endObj.time);

      const uid = (crypto.randomUUID ? crypto.randomUUID() : String(Date.now())) + "@danasnaglar";
      const summary = `Danas Naglar: ${service}`;
      const desc = `Bokning för ${nameEl.value.trim()} (${phoneEl.value.trim()}).`;

      const ics =
`BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//Danas Naglar//Booking//SV
CALSCALE:GREGORIAN
BEGIN:VEVENT
UID:${uid}
DTSTAMP:${new Date().toISOString().replace(/[-:]/g,"").replace(/\.\d+Z$/,"Z")}
DTSTART:${start}
DTEND:${end}
SUMMARY:${summary}
DESCRIPTION:${desc}
END:VEVENT
END:VCALENDAR`;

      const blob = new Blob([ics], { type: "text/calendar;charset=utf-8" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "danas-naglar-bokning.ics";
      document.body.appendChild(a);
      a.click();
      a.remove();

      showToast("ok", `<strong>Kalenderfil skapad.</strong> Ladda ner och öppna den för att lägga in i din kalender.`);
   }

   // --- Admin ---
   function isAdmin(){
      return new URLSearchParams(location.search).get("admin") === "1";
   }

   function renderAdmin(){
      if(!isAdmin()) return;
      adminTitle.style.display = "block";
      adminArea.style.display = "block";

      const bookings = getBookings();
      adminTableBody.innerHTML = "";

      if(bookings.length === 0){
         adminTableBody.innerHTML = `<tr><td colspan="5" style="color: var(--muted);">Inga bokningar än.</td></tr>`;
         return;
      }

      for(const b of bookings){
         const tr = document.createElement("tr");
         tr.innerHTML = `
            <td>${escapeHtml(b.date)}<br/><span class="tag">${escapeHtml(b.time)}</span></td>
            <td>${escapeHtml(b.service)}</td>
            <td>${escapeHtml(b.name)}</td>
            <td>${escapeHtml(b.phone)}</td>
            <td>${escapeHtml(b.notes || "")}</td>
         `;
         adminTableBody.appendChild(tr);
      }
   }

   function exportJSON(){
      const bookings = getBookings();
      const blob = new Blob([JSON.stringify(bookings, null, 3)], { type: "application/json;charset=utf-8" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "danas-naglar-bokningar.json";
      document.body.appendChild(a);
      a.click();
      a.remove();
   }

   function wipeAll(){
      if(!confirm("Radera alla bokningar från denna webbläsare?")) return;
      saveBookings([]);
      renderSlots();
      renderAdmin();
      showToast("ok", "<strong>Klart.</strong> Alla lokala bokningar är raderade.");
   }

   // Init
   dateEl.min = todayISO();
   dateEl.value = todayISO();
   renderSlots();
   renderAdmin();

   dateEl.addEventListener("change", renderSlots);
   bookBtn.addEventListener("click", book);
   clearBtn.addEventListener("click", clearForm);
   icsBtn.addEventListener("click", downloadICS);

   if(isAdmin()){
      exportBtn.addEventListener("click", exportJSON);
      wipeBtn.addEventListener("click", wipeAll);
   }
</script>
<section id="booking">
  <h2>Boka tid</h2>
  <p>Fyll i dina uppgifter för att boka tid</p>

  <iframe
    src="https://docs.google.com/forms/d/e/1FAIpQLSfZG0gr4XpOIpLPLe2eMrBmaMtHcTbc4v1wazLLgj5HzmEkkA/viewform?embedded=true"
    width="100%"
    height="900"
    frameborder="0"
    marginheight="0"
    marginwidth="0">
    Laddar…
  </iframe>
</section>
</body>
</html>


   
   

